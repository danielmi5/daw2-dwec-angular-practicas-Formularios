<header>
  <h2>Gestor de productos</h2>
</header>

<main>
  <form [formGroup]="productosForm" (ngSubmit)="onSubmit()" novalidate>
    <fieldset>
      <label for="nombre">Nombre del producto:</label>
      <input id="nombre" type="text" formControlName="nombre" />
      @if (productosForm.get('nombre')?.touched && productosForm.get('nombre')?.invalid) {
        @if (productosForm.get('nombre')?.errors?.['required']) {
          <p class="error">Obligatorio</p>
        }
        @if (productosForm.get('nombre')?.errors?.['minlength']) {
          <p class="error">Mínimo 3 caracteres</p>
        }
      }
    </fieldset>

    <fieldset>
      <label for="descripcion">Descripción:</label>
      <textarea id="descripcion" formControlName="descripcion"></textarea>
      @if (productosForm.get('descripcion')?.touched && productosForm.get('descripcion')?.invalid) {
        @if (productosForm.get('descripcion')?.errors?.['required']) {
          <p class="error">Obligatorio</p>
        }
        @if (productosForm.get('descripcion')?.errors?.['maxlength']) {
          <p class="error">Máximo 200 caracteres</p>
        }
      }
    </fieldset>

    <fieldset>
      <label for="precio">Precio (€):</label>
      <input id="precio" type="number" step="0.01" formControlName="precio" />
      @if (productosForm.get('precio')?.touched && productosForm.get('precio')?.invalid) {
        @if (productosForm.get('precio')?.errors?.['required']) {
          <p class="error">Obligatorio</p>
        }
        @if (productosForm.get('precio')?.errors?.['min']) {
          <p class="error">Debe ser mayor a 0</p>
        }
      }
    </fieldset>

    <fieldset>
      <label for="cantidad">Cantidad:</label>
      <input id="cantidad" type="number" formControlName="cantidad" />
      @if (productosForm.get('cantidad')?.touched && productosForm.get('cantidad')?.invalid) {
        @if (productosForm.get('cantidad')?.errors?.['required']) {
          <p class="error">Obligatorio</p>
        }
        @if (productosForm.get('cantidad')?.errors?.['min']) {
          <p class="error">Mínimo 1</p>
        }
        @if (productosForm.get('cantidad')?.errors?.['max']) {
          <p class="error">Máximo 1000</p>
        }
      }
    </fieldset>

    <fieldset>
      <label for="categoria">Categoría:</label>
      <input id="categoria" type="text" formControlName="categoria" />
      @if (productosForm.get('categoria')?.touched && productosForm.get('categoria')?.invalid) {
        @if (productosForm.get('categoria')?.errors?.['required']) {
          <p class="error">Obligatorio</p>
        }
      }
    </fieldset>

    <footer class="acciones">
      <button type="submit">Añadir producto</button>
    </footer>
  </form>

  <section aria-labelledby="listado-title" class="listado-productos">
    <h3 id="listado-title">Listado de productos</h3>

    @if (productos.length > 0) {
      <table class="tabla-productos">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Categoría</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Subtotal</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (producto of productos; track producto.id) {
            <tr>
              <td>{{ producto.id }}</td>
              <td>{{ producto.nombre }}</td>
              <td>{{ producto.descripcion }}</td>
              <td>{{ producto.categoria }}</td>
              <td>{{ producto.precio | number:'1.2-2' }} €</td>
              <td>{{ producto.cantidad }}</td>
              <td>{{ (producto.precio * producto.cantidad) | number:'1.2-2' }} €</td>
              <td>
                <button (click)="eliminarProducto(producto.id)">Eliminar</button>
              </td>
            </tr>
          }
        </tbody>
        <tfoot>
          <tr>
            <td colspan="6">Total:</td>
            <td>{{ calcularTotal() | number:'1.2-2' }} €</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    }

    @if (productos.length === 0) {
      <p>No hay productos añadidos.</p>
    }
  </section>
</main>

