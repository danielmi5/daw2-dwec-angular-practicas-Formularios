<h2>Formulario de registro</h2>

<main>
  <form #registroForm="ngForm" (ngSubmit)="onSubmit(registroForm)" novalidate>
    <fieldset>
      <label for="nombre">Nombre completo:</label>
      <input
        id="nombre"
        name="nombre"
        [(ngModel)]="usuario.nombre"
        #nombre="ngModel"
        required
        minlength="3"
      />
      @if (nombre.invalid && (nombre.dirty || nombre.touched)) {
        @if (nombre.errors && nombre.errors['required']) {
          <p class="error">El nombre es requerido</p>
        }
        @if (nombre.errors && nombre.errors['minlength']) {
          <p class="error">Mínimo 3 caracteres</p>
        }
      }
    </fieldset>

    <fieldset>
      <label for="email">Email:</label>
      <input
        id="email"
        name="email"
        type="email"
        [(ngModel)]="usuario.email"
        #email="ngModel"
        required
        email
      />
      @if (email.invalid && (email.dirty || email.touched)) {
        @if (email.errors && email.errors['required']) {
          <p class="error">El email es requerido</p>
        }
        @if (email.errors && email.errors['email']) {
          <p class="error">Formato de email inválido</p>
        }
      }
    </fieldset>

    <fieldset>
      <label for="password">Contraseña:</label>
      <input
        id="password"
        name="password"
        type="password"
        [(ngModel)]="usuario.password"
        #password="ngModel"
        (ngModelChange)="comprobarContrasenias()"
        required
        minlength="6"
      />
      @if (password.invalid && (password.dirty || password.touched)) {
        @if (password.errors && password.errors['required']) {
          <p class="error">La contraseña es obligatoria</p>
        }
        @if (password.errors && password.errors['minlength']) {
          <p class="error">Mínimo 6 caracteres</p>
        }
      }
    </fieldset>

    <fieldset>
      <label for="confirmPassword">Confirmar contraseña:</label>
      <input
        id="confirmPassword"
        name="confirmPassword"
        type="password"
        [(ngModel)]="usuario.confirmPassword"
        #confirmPassword="ngModel"
        (ngModelChange)="comprobarContrasenias()"
        required
      />
      @if (confirmPassword.invalid && (confirmPassword.dirty || confirmPassword.touched)) {
        @if (confirmPassword.errors && confirmPassword.errors['required']) {
          <p class="error">La confirmación es obligatoria</p>
        }
      }
    </fieldset>

    @if (contraseniasCoinciden) {
      <p class="error" role="alert">Las contraseñas no coinciden</p>
    }

    <footer class="actions">
      <button type="submit" [disabled]="registroForm.invalid || contraseniasCoinciden">Registrarse</button>
    </footer>
  </form>

  <p class="success">{{ mensajeExito }}</p>

  @if (usuariosRegistrados.length > 0) {
    <section aria-labelledby="usuarios-title" class="usuarios-registrados">
      <h3 id="usuarios-title">Usuarios registrados</h3>
      <ul>
        @for (usuario of usuariosRegistrados; track usuario.id) {
          <li>
            <strong>{{ usuario.nombre }}</strong> / {{ usuario.email }}
          </li>
        }
      </ul>
    </section>
  }
</main>
